#include <DHT.h>
#include <DHT_U.h>

#include <TheThingsNetwork.h>

// Set your AppEUI and AppKey
const char *appEui = "70B3D57ED001F00B";
const char *appKey = "2CD67A776DD82FD691B248AF480BC60A";


#define loraSerial Serial1
#define debugSerial Serial

// Replace REPLACE_ME with TTN_FP_EU868 or TTN_FP_US915
#define freqPlan TTN_FP_EU868

DHT dht(2, DHT22);

TheThingsNetwork ttn(loraSerial, debugSerial, freqPlan);

void setup()
{
  loraSerial.begin(57600);
  debugSerial.begin(9600);

  // Wait a maximum of 10s for Serial Monitor
  while (!debugSerial && millis() < 10000)
    ;

  debugSerial.println("-- STATUS");
  ttn.showStatus();

  debugSerial.println("-- JOIN");
  ttn.join(appEui, appKey);

  dht.begin();
}

void loop()
{
  debugSerial.println("-- LOOP");

  float humidity = dht.readHumidity(false);
  float temperature = dht.readTemperature(false);

  debugSerial.println("Humidity:" + String(humidity));
  debugSerial.println("Temperature:" + String(temperature));

  delay(10000);
}
